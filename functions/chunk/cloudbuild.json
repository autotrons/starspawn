{
  "steps": [
    {
      "name": "gcr.io/cloud-builders/yarn",
      "args": ["install"],
      "dir": "./functions/${_FUNCTION_NAME}"
    },
    {
      "name": "gcr.io/cloud-builders/npm",
      "args": ["test"],
      "dir": "./functions/${_FUNCTION_NAME}"
    },
    {
      "name": "gcr.io/cloud-builders/gcloud",
      "args": ["beta", "functions", "deploy", "${_FUNCTION_NAME}", "--trigger-resource", "datafeeds", "--trigger-event", "google.storage.object.finalize"],
      "dir": "./functions/${_FUNCTION_NAME}"
    }
  ],
  "tags": ["service", "${_FUNCTION_NAME}"]
}

